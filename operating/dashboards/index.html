<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='A large part of providing a stable Fediverse platform is comprehensive operational monitoring. In common with many Kubernetes-based instances, we picked Prometheus to scrape operational metrics, and Grafana to display them in a series of dashboards. We also wanted to publish these dashboards to meet the principle of "Default to Open" from the US Digital Service Playbook.'><meta name=author content="Anthony Rodgers"><link href=https://docs.govsocial.org/operating/dashboards/ rel=canonical><link href=../documentation/ rel=prev><link href=kubernetes/ rel=next><link rel=icon href=../../images/govsocial_logo.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.8"><title>Installation - GOVSocial Project Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.0d440cfe.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style><link rel=stylesheet href=../../extras/css/icons.css><link rel=stylesheet href=../../stylesheets/govsocial.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#operational-dashboards class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <a rel=me href=https://mstdn.ca/@cunningpike></a> <style>.md-banner a,.md-banner a:focus,.md-banner a:hover{color:currentColor}.md-banner strong{white-space:nowrap}.md-banner .twitter{margin-left:.2em;color:#00acee}</style> <div align=center> <a href=https://github.com/sponsors/govsocial-org> Please consider supporting us via <strong>GitHub Sponsors</strong> </a> </div> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="GOVSocial Project Documentation" class="md-header__button md-logo" aria-label="GOVSocial Project Documentation" data-md-component=logo> <img src=../../images/govsocial_logo_white.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> GOVSocial Project Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Installation </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Burn my eyes!" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Burn my eyes!" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Love my eyes!" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Love my eyes!" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/govsocial-org/govsocial-org.github.io/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> govsocial-org.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../building/ class=md-tabs__link> Building GOVSocial </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> Operating GOVSocial </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="GOVSocial Project Documentation" class="md-nav__button md-logo" aria-label="GOVSocial Project Documentation" data-md-component=logo> <img src=../../images/govsocial_logo_white.png alt=logo> </a> GOVSocial Project Documentation </label> <div class=md-nav__source> <a href=https://github.com/govsocial-org/govsocial-org.github.io/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> govsocial-org.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__link--index "> <a href=../../building/ >Building GOVSocial</a> <label for=__nav_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Building GOVSocial </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> Preparation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Preparation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../building/cluster/ class=md-nav__link> Creating the Cluster </a> </li> <li class=md-nav__item> <a href=../../building/domains/ class=md-nav__link> DNS Domains </a> </li> <li class=md-nav__item> <a href=../../building/email/ class=md-nav__link> Transactional Email </a> </li> <li class=md-nav__item> <a href=../../building/storage/ class=md-nav__link> S3 Storage </a> </li> <li class=md-nav__item> <a href=../../building/postgresql/ class=md-nav__link> PostgreSQL </a> </li> <li class=md-nav__item> <a href=../../building/fluxhelm/ class=md-nav__link> Flux/Helm </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> Platform Installs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Platform Installs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../building/mastodon/ class=md-nav__link> Mastodon </a> </li> <li class=md-nav__item> <a href=../../building/fediblockhole/ class=md-nav__link> FediBlockHole </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__link--index "> <a href=../ >Operating GOVSocial</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Operating GOVSocial </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> General Operations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> General Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../documentation/ class=md-nav__link> Documentation </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2 checked> <label class=md-nav__link for=__nav_3_2_2 id=__nav_3_2_2_label tabindex=0> Dashboards <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Dashboards </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Installation <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Installation </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installing-prometheus-and-grafana class=md-nav__link> Installing Prometheus and Grafana </a> <nav class=md-nav aria-label="Installing Prometheus and Grafana"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prometheus class=md-nav__link> Prometheus </a> <nav class=md-nav aria-label=Prometheus> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gke-cadvisor class=md-nav__link> GKE cAdvisor </a> </li> <li class=md-nav__item> <a href=#statsd-exporter class=md-nav__link> Statsd Exporter </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#grafana class=md-nav__link> Grafana </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=kubernetes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=cloudsql/ class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=cloudstorage/ class=md-nav__link> Cloud Storage </a> </li> <li class=md-nav__item> <a href=mastodon/ class=md-nav__link> Mastodon </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> Instance Operations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Instance Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../mastodon/ class=md-nav__link> Mastodon </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installing-prometheus-and-grafana class=md-nav__link> Installing Prometheus and Grafana </a> <nav class=md-nav aria-label="Installing Prometheus and Grafana"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prometheus class=md-nav__link> Prometheus </a> <nav class=md-nav aria-label=Prometheus> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gke-cadvisor class=md-nav__link> GKE cAdvisor </a> </li> <li class=md-nav__item> <a href=#statsd-exporter class=md-nav__link> Statsd Exporter </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#grafana class=md-nav__link> Grafana </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=operational-dashboards>Operational Dashboards<a class=headerlink href=#operational-dashboards title="Permanent link">&para;</a></h1> <p>A large part of providing a stable Fediverse platform is comprehensive operational monitoring. In common with many Kubernetes-based instances, we picked <a href=https://prometheus.io/ >Prometheus</a> to scrape operational metrics, and <a href=https://grafana.com/ >Grafana</a> to display them in a series of dashboards. We also wanted to publish these dashboards to meet the principle of <a href=https://playbook.cio.gov/#play13>"Default to Open"</a> from the <a href=https://www.usds.gov/ >US Digital Service</a> <a href=https://playbook.cio.gov/ >Playbook</a>.</p> <p>As explained below, the Grafana <code>publicDashboards</code> <a href=https://grafana.com/docs/grafana/latest/dashboards/dashboard-public/ >feature</a> is in alpha at the moment, and does not support dashboards that contain template variables (which is most of them!). Until that becomes possible, we are committing to providing monthly screenshots of our operational metrics.</p> <h2 id=installing-prometheus-and-grafana>Installing Prometheus and Grafana<a class=headerlink href=#installing-prometheus-and-grafana title="Permanent link">&para;</a></h2> <p>The <a href=https://cloud.google.com/marketplace>GKE Marketplace</a> provides two products, "Prometheus &amp; Grafana", which (despite its name) provides a Grafana-ready implementation of Prometheus 2.41 only, and "Grafana", which provides Grafana 7.4.</p> <h3 id=prometheus>Prometheus<a class=headerlink href=#prometheus title="Permanent link">&para;</a></h3> <p>The Marketplace install of Prometheus is reasonably current, so we deployed that. No configuration changes were needed for our implementation.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>If you plan to deploy an Ingress in front of Prometheus (we did not, using <a href=https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/ >Port Forwarding</a> instead), the provided values of <code>timeoutSeconds: 30</code> for both the <code>livenessProbe</code> and <code>readinessProbe</code> will need to be reduced to below 30 in the YAML for the StatefulSet to avoid the GKE strict implementation of <code>TimeoutSec should be less than checkIntervalSec</code>. The default value of <code>checkIntervalSec</code> in GKE is 30 seconds, and <code>timeoutSeconds</code> must be less than that<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup>.</p> </div> <p>One of the advantages of the GKE Marketplace Prometheus implementation is that it comes with a Google Cloud Monitoring datasource already configured. This datasource comes with some excellent pre-defined dashboards for Cloud SQL, Cloud Storage, and Load Balancers.</p> <p>Most of the exporters in the GKE-provided Prometheus worked just fine as installed, but we encountered a wrinkle with the <a href=https://github.com/google/cadvisor>cAdvisor</a> exporter. We also needed to add a <a href=https://github.com/prometheus/statsd_exporter>Statsd exporter</a> in order for our Mastodon dashboard to work.</p> <h4 id=gke-cadvisor>GKE cAdvisor<a class=headerlink href=#gke-cadvisor title="Permanent link">&para;</a></h4> <p>When we installed the GKE Marketplace Prometheus application, the GKE cAdvisor didn't emit any data as initially configured. After a <em>lot</em> of trouble-shooting, we eventually found this little nugget in the <code>prometheus-1-prometheus-config</code> ConfigMap:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">prometheus.yaml</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">|</span>
<span class=w>    </span><span class=no>...</span>
<span class=w>    </span><span class=no>&quot;scrape_configs&quot;:</span>
<span class=w>    </span><span class=no>...</span>
<span class=w>    </span><span class=no>- &quot;job_name&quot;: &quot;gke-cadvisor&quot;</span>
<span class=w>      </span><span class=no>...</span>
<span class=hll><span class=w>      </span><span class=no>&quot;metric_relabel_configs&quot;:</span>
</span><span class=hll><span class=w>      </span><span class=no>- &quot;action&quot;: &quot;drop&quot;</span>
</span><span class=hll><span class=w>        </span><span class=no>&quot;regex&quot;: &quot;^$&quot;</span>
</span><span class=hll><span class=w>        </span><span class=no>&quot;source_labels&quot;:</span>
</span><span class=hll><span class=w>        </span><span class=no>- &quot;namespace&quot;</span>
</span><span class=hll><span class=w>      </span><span class=no>- &quot;action&quot;: &quot;drop&quot;</span>
</span><span class=hll><span class=w>        </span><span class=no>&quot;regex&quot;: &quot;^$&quot;</span>
</span><span class=hll><span class=w>        </span><span class=no>&quot;source_labels&quot;:</span>
</span><span class=hll><span class=w>        </span><span class=no>- &quot;pod_name&quot;</span>
</span></code></pre></div> <p>The effect of this was to effectively silence the exporter, meaning that, while the exporter itself appeared healthy, it wasn't sending any data. Removing the entire <code>metric_relabel_configs</code> block (highlighted above) solved that problem<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup>.</p> <h4 id=statsd-exporter>Statsd Exporter<a class=headerlink href=#statsd-exporter title="Permanent link">&para;</a></h4> <p>At least one Fediverse platform, Mastodon, has a <a href=https://docs.joinmastodon.org/admin/config/#statsd>built-in StatsD exporter</a>. What we needed was a way to convert the metrics from the StatsD format to Prometheus format. The <a href=https://github.com/prometheus-community>Prometheus Community</a> GitHub repo publishes a <a href=https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus-statsd-exporter>Helm chart for their statsd-exporter</a>, which does exactly that. This we installed in <a href=/building/fediblockhole/#deploying-fediblockhole>the usual way</a>.</p> <h3 id=grafana>Grafana<a class=headerlink href=#grafana title="Permanent link">&para;</a></h3> <p>The Marketplace version of Grafana is too old to support the dashboards we wanted to use. Instead, we installed Grafana 9.3 from the <a href=https://github.com/bitnami/charts/tree/main/bitnami/grafana>Bitnami chart</a>. The method we used is identical to how we <a href=/building/fediblockhole/#deploying-fediblockhole>installed FediBlockHole</a>, so we won't repeat it here. The only configuration changes we made were:</p> <div class=highlight><span class=filename>/grafana/configmap-grafana-helm-chart-value-overrides.yaml</span><pre><span></span><code><span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class=nt>values.yaml</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|-</span><span class=w> </span>
<span class=w>     </span><span class=no>grafana:</span>
<span class=w>       </span><span class=no>updateStrategy:</span>
<span class=w>        </span><span class=no>type: Recreate</span>
<span class=w>       </span><span class=no>extraEnvVars:</span>
<span class=w>        </span><span class=no>- name: GF_FEATURE_TOGGLES_ENABLE</span>
<span class=w>          </span><span class=no>value: publicDashboards</span>
</code></pre></div> <p>The change to <code>updateStrategy.type</code> is to remove the multi-mount contention on the Persistent Volume claim that a <code>RollingUpdate</code> type encounters with the <code>standard-rwo</code> StorageClass in a Kubernetes Deployment.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>This change means that the Grafana service will be briefly unavailable during pod updates. We determined we could live with it. YMMV.</p> </div> <p>The <code>extraEnvVars</code> setting enables the <code>publicDashboards</code> <a href=https://grafana.com/docs/grafana/latest/dashboards/dashboard-public/ >feature</a>, which is currently in alpha release. We intended to publish our Grafana dashboards as part of this site, but all the dashboards we use use template variables, which are not currently supported. Until they are, we will publish monthly screenshots instead.</p> <p>We also created a DNS entry and <a href=https://cloud.google.com/kubernetes-engine/docs/tutorials/http-balancer>HTTPS Ingress</a> for our Grafana install, so we could access it from the Internet.</p> <p>When you get Grafana running, you will be presented with a login screen. Because we implemented in GKE from a Helm chart which creates the <code>admin</code> user and generates a secret for it, we had no idea what it was, so we extracted it from the secret with this command:</p> <div class=highlight><pre><span></span><code>~$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>--namespace<span class=w> </span>default<span class=w> </span>grafana<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{.data.admin-password}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>--decode<span class=w> </span><span class=p>;</span><span class=w> </span><span class=nb>echo</span>
</code></pre></div> <p>Once that's done, you should be able to login to your Grafana instance and start dashboarding!</p> <div class=footnote> <hr> <ol> <li id=fn:1> <p>It's kinda bizarre that Google didn't fix this in their Marketplace offering...&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p>Another bizarre configuration choice in the Marketplace install...&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> </ol> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">February 18, 2023</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Anthony Rodgers, GOVSocial </div> </div> <div class=md-social> <a href=https://mstdn.ca/@cunningpike target=_blank rel=noopener title=mstdn.ca class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg> </a> <a href=https://github.com/govsocial-org target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://docs.govsocial.org/ target=_blank rel=noopener title=docs.govsocial.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20 5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"/></svg> </a> <a href=https://www.linkedin.com/in/anthonylrodgers target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=mailto:cunningpike@gmail.com target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 4H7a5 5 0 0 0-5 5v11h18a2 2 0 0 0 2-2V9a5 5 0 0 0-5-5m-7 14H4V9a3 3 0 0 1 3-3 3 3 0 0 1 3 3v9m9-3h-2v-2h-4v-2h6v4M9 11H5V9h4v2Z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.sections", "navigation.indexes", "navigation.top", "navigation.pruning", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "header.autohide", "announce.dismiss", "toc.follow"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.a00a7c5e.min.js></script> <script src=../../extras/javascript/plausible.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../extras/javascript/tablesort.js></script> </body> </html>